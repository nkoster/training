<!DOCTYPE HTML>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>keys</title>
</head>
<body>
<input type="text" id="in">
<div id="aap"></div>
<script>
var debug = true
var messageBuffer = []
var messageBufferIndex = 0
var message = document.getElementById('in')
var aap = document.getElementById('aap')
var userList = ['gijs', 'henk', 'willem']
document.write(userList)
message.onkeydown = function(e) {
    switch(e.keyCode) {
        case 8:
            if (debug) console.log('BACKSPACE')
            break
        case 9:
            e.preventDefault()
            if (debug) console.log('TAB')
            var messageWords = message.value.split(' ')
            var searchInput = messageWords[messageWords.length -1]
            var user = []
            userList.forEach(function(element) {
                if (element.includes(searchInput)) user.push(element)
            })
            if (user.length === 1) {
                messageWords[messageWords.length - 1] = user[0]
                message.value = messageWords.join(' ')
            }
            break
        case 13:
            e.preventDefault()
            if (message.value.length > 0) {
                if (messageBuffer[messageBuffer.length - 2] !== message.value) {
                    messageBuffer[messageBuffer.length - 1] = message.value
                    messageBuffer.push('')
                }
                message.value = ''
                messageBufferIndex = messageBuffer.length - 1
            }
            if (debug) console.log('ENTER')
            break
        case 38:
            if (debug) console.log('ARROW UP')
            if (messageBufferIndex > 0) messageBufferIndex--
            message.value = messageBuffer[messageBufferIndex]
            break
        case 40:
            if (debug) console.log('ARROW DOWN')
            if (messageBufferIndex < messageBuffer.length - 1) {
                messageBufferIndex++
                message.value = messageBuffer[messageBufferIndex]  
            }
            break
        default:
            if (debug) console.log('keycode', e.keyCode)
    }
    if (debug) console.log(messageBuffer)
}
message.onkeyup = function(e) {
    aap.innerText = message.value
    messageBuffer[messageBufferIndex] = message.value
    if (debug) console.log('messageBufferIndex', messageBufferIndex, 'length', messageBuffer.length - 1)
}
message.onfocus = message.onkeyup
message.onblur = message.onkeyup
</script>
</body>
</html>
