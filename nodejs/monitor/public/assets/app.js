function filter(e){filterText=e;var t=9*(e.length+1);t>inputMinSize?(document.getElementById("freetext").style.width=t+"px",document.getElementById("freetext").style.minWidth=t+"px",document.getElementById("freetext").style.maxWidth=t+"px"):(document.getElementById("freetext").style.width=inputMinSize+"px",document.getElementById("freetext").style.minWidth=inputMinSize+"px",document.getElementById("freetext").style.maxWidth=inputMinSize+"px")}function updateMonitor(e){monitor[counter]=e,div="";var t,n,o,l,i,r,a,c,s,d;for(t=0;t<monitor.length;t++)n=monitor[t].split(" "),o=parseFloat(n[1]),d="#2f5",o>1&&(d="#fa3"),o>2&&(d="#f32"),l=o.toFixed(3),l=new Array(7-l.length).join(" ")+l,i=n[0],r=n[2],r=new Array(17-r.length).join(" ")+r,a=n[3],c="normal",s="none",t==counter&&(c="bold",s=d,d="black"),div+='<div class="monitor" style="color:'+d+";font-weight:"+c+";background:"+s+'"> '+i+"   "+l+" "+r+"   "+a+"</div>\n";screenChanged&&(screenChanged=!1,monitor.splice(numberOfLines),div.split("\n").slice(numberOfLines).join("\n"),counter>numberOfLines&&(counter=numberOfLines)),document.getElementById("monitor").innerHTML=div,numberOfLines-1>counter?counter+=1:counter=0,timeout=0}function alarmOn(e){alarmEnabled&&(oscillator1=context.createOscillator(),oscillator1.type="sine",oscillator1.connect(context.destination),oscillator1.frequency.value=e,oscillator1.start(0))}function alarmOff(){alarmEnabled&&"undefined"!=typeof oscillator1&&oscillator1.stop(0)}function handleKeyDown(e){var t=0,n=0,o=null===e?event:e;return n=o.altKey,t=o.ctrlKey,(n||t)&&70===o.keyCode&&(filterMenu?(document.getElementById("overlay").style.transition="opacity 0.4s",document.getElementById("filter").style.transition="opacity 0.5s",document.getElementById("overlay").style.opacity="0.0",document.getElementById("filter").style.opacity="0.0",filterMenu=!1):(document.getElementById("overlay").style.transition="opacity 0.5s",document.getElementById("filter").style.transition="opacity 0.5s",document.getElementById("overlay").style.opacity="0.4",document.getElementById("filter").style.opacity="0.9",document.getElementById("freetext").focus(),filterMenu=!0)),(n||t)&&83===o.keyCode&&(alarmEnabled=alarmEnabled?!1:!0),!0}!function(e,t){"function"==typeof define&&define.amd?define([],t):"undefined"!=typeof module&&module.exports?module.exports=t():e.ReconnectingWebSocket=t()}(this,function(){function e(t,n,o){function l(e,t){var n=document.createEvent("CustomEvent");return n.initCustomEvent(e,!1,!1,t),n}var i={debug:!1,automaticOpen:!0,reconnectInterval:1e3,maxReconnectInterval:3e4,reconnectDecay:1.5,timeoutInterval:2e3,maxReconnectAttempts:null};o||(o={});for(var r in i)this[r]="undefined"!=typeof o[r]?o[r]:i[r];this.url=t,this.reconnectAttempts=0,this.readyState=WebSocket.CONNECTING,this.protocol=null;var a,c=this,s=!1,d=!1,u=document.createElement("div");u.addEventListener("open",function(e){c.onopen(e)}),u.addEventListener("close",function(e){c.onclose(e)}),u.addEventListener("connecting",function(e){c.onconnecting(e)}),u.addEventListener("message",function(e){c.onmessage(e)}),u.addEventListener("error",function(e){c.onerror(e)}),this.addEventListener=u.addEventListener.bind(u),this.removeEventListener=u.removeEventListener.bind(u),this.dispatchEvent=u.dispatchEvent.bind(u),this.open=function(t){if(a=new WebSocket(c.url,n||[]),t){if(this.maxReconnectAttempts&&this.reconnectAttempts>this.maxReconnectAttempts)return}else u.dispatchEvent(l("connecting")),this.reconnectAttempts=0;(c.debug||e.debugAll)&&console.debug("ReconnectingWebSocket","attempt-connect",c.url);var o=a,i=setTimeout(function(){(c.debug||e.debugAll)&&console.debug("ReconnectingWebSocket","connection-timeout",c.url),d=!0,o.close(),d=!1},c.timeoutInterval);a.onopen=function(n){clearTimeout(i),(c.debug||e.debugAll)&&console.debug("ReconnectingWebSocket","onopen",c.url),c.protocol=a.protocol,c.readyState=WebSocket.OPEN,c.reconnectAttempts=0;var o=l("open");o.isReconnect=t,t=!1,u.dispatchEvent(o)},a.onclose=function(n){if(clearTimeout(i),a=null,s)c.readyState=WebSocket.CLOSED,u.dispatchEvent(l("close"));else{c.readyState=WebSocket.CONNECTING;var o=l("connecting");o.code=n.code,o.reason=n.reason,o.wasClean=n.wasClean,u.dispatchEvent(o),t||d||((c.debug||e.debugAll)&&console.debug("ReconnectingWebSocket","onclose",c.url),u.dispatchEvent(l("close")));var i=c.reconnectInterval*Math.pow(c.reconnectDecay,c.reconnectAttempts);setTimeout(function(){c.reconnectAttempts++,c.open(!0)},i>c.maxReconnectInterval?c.maxReconnectInterval:i)}},a.onmessage=function(t){(c.debug||e.debugAll)&&console.debug("ReconnectingWebSocket","onmessage",c.url,t.data);var n=l("message");n.data=t.data,u.dispatchEvent(n)},a.onerror=function(t){(c.debug||e.debugAll)&&console.debug("ReconnectingWebSocket","onerror",c.url,t),u.dispatchEvent(l("error"))}},1==this.automaticOpen&&this.open(!1),this.send=function(t){if(a)return(c.debug||e.debugAll)&&console.debug("ReconnectingWebSocket","send",c.url,t),a.send(t);throw"INVALID_STATE_ERR : Pausing to reconnect websocket"},this.close=function(e,t){"undefined"==typeof e&&(e=1e3),s=!0,a&&a.close(e,t)},this.refresh=function(){a&&a.close()}}if("WebSocket"in window)return e.prototype.onopen=function(e){},e.prototype.onclose=function(e){},e.prototype.onconnecting=function(e){},e.prototype.onmessage=function(e){},e.prototype.onerror=function(e){},e.debugAll=!1,e.CONNECTING=WebSocket.CONNECTING,e.OPEN=WebSocket.OPEN,e.CLOSING=WebSocket.CLOSING,e.CLOSED=WebSocket.CLOSED,e});var lineHeight=17,monitorHeight=window.innerHeight,numberOfLines=Math.floor(monitorHeight/lineHeight)-1;3>numberOfLines&&(numberOfLines=3);var timeoutThreshold=30,timeout=0,monitor=[],counter=0,div="",screenChanged=!1,filterMenu=!1,filterText="",inputMinSize=200,alarmRed=0,alarmBlack=0,alarmEnabled=!1,context=new AudioContext,oscillator1,host=window.document.location.host.replace(/:.*/,""),ws=new ReconnectingWebSocket("ws://"+host+":8080");ws.reconnectInterval=1e4,ws.onmessage=function(e){var t=String(e.data),n=t.split(" ");if(n.length>3){var o=parseFloat(n[1]);if(!isNaN(o)){var l,i,r,a,c,s,d,u,m,f,g,y,p=filterText.replace(/\s+$/,"").split(" "),h=!0,b=p.length;for(i=0;b>i;i++)if(a=p[i],s=!1,d=!1,u=!1,m=!1,f=0,"!"===a[0]&&(a=a.replace(/\!/,""),s=!0),">"===a[0]?(a=a.replace(/\>/,""),d=!0,u=!0):u=!1,"<"===a[0]?(a=a.replace(/</,""),d=!0,m=!0):m=!1,d&&(f=parseFloat(a),isNaN(f)&&(f=0),a=""),0!==a.length||d){if(u&&f>o&&(h=!1),m&&o>f&&(h=!1),!d)if(a.indexOf("|")>0){for(l=a.replace(/\|$/,"").split("|"),g=l.length,y=!1,r=0;g>r;r++)c=l[r],t.indexOf(c)>0&&(y=!0);y||(h=!1)}else s?t.indexOf(a)>=0&&(h=!1):t.indexOf(a)<0&&(h=!1)}else h=!0;0===filterText.indexOf("#")&&(h=!0),h&&updateMonitor(t)}}},window.onresize=function(){monitorHeight=window.innerHeight;var e=Math.floor(monitorHeight/lineHeight)-1;3>e&&(e=3),numberOfLines=e,screenChanged=!0},document.onkeydown=handleKeyDown;var stateFilter=0,stateAlarm=0,showFilterAlert=!1;setInterval(function(){timeout>timeoutThreshold?(document.getElementById("l2").style.transition="all 0.5s",document.getElementById("l2").style.background="#700",1>alarmRed&&1!==alarmBlack?(alarmOn(380),alarmRed++):alarmOff(),alarmBlack=0):(document.getElementById("l2").style.background="black",1>alarmBlack&&1!==alarmRed?(alarmOn(190),alarmBlack++):alarmOff(),alarmRed=0,timeout++),filterText.length>0&&0!==filterText.indexOf("#")?(showFilterAlert=!0,document.getElementById("filteralert").style.transition="all 0.9s",document.getElementById("filteralert").style.opacity="0.9",0===stateFilter?(document.getElementById("filteralert").style.background="#fe0",stateFilter=1):(document.getElementById("filteralert").style.background="#330",stateFilter=0)):(showFilterAlert=!1,stateFilter=0,document.getElementById("filteralert").style.opacity="0"),alarmEnabled?(document.getElementById("alarmalert").style.top=showFilterAlert?"25px":"2px",document.getElementById("alarmalert").style.transition="all 0.9s",1===stateFilter&&(stateAlarm=0),0===stateAlarm?(document.getElementById("alarmalert").style.opacity="0.2",stateAlarm=1):(document.getElementById("alarmalert").style.opacity="0.9",stateAlarm=0)):document.getElementById("alarmalert").style.opacity="0"},1e3);